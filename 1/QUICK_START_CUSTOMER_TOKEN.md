# Quick Start: Getting Customer Access Token

## TL;DR - The Simplest Approach

Your App Proxy already reads the token from cookies automatically! You don't need to manually get or pass the token in most cases.

## Where customerAccessToken Comes From

1. **Generated by Shopify** when customer logs in/registers
2. **Stored in cookie** automatically by Shopify Customer Account API
3. **Cookie name:** `customerAccessToken` or `__customer_access_token`

## How to Use It (3 Simple Options)

### Option 1: Let Shopify Handle It (Easiest) ✅

Just redirect to your App Proxy. It will automatically read the token from cookie:

```javascript
// From your storefront - just redirect!
window.location.href = '/apps/xwan-ai-sso/check-login?return_to=/dashboard';
```

Your App Proxy endpoint (`app-proxy.check-login.tsx`) already handles this:
```typescript
// It reads from cookie automatically
const cookies = request.headers.get("cookie") || "";
const cookieMatch = cookies.match(/customerAccessToken=([^;]+)/);
if (cookieMatch) {
  const token = cookieMatch[1];
  // Use token...
}
```

### Option 2: Get from Cookie Manually (If Needed)

If you need the token in JavaScript:

```javascript
function getCustomerAccessToken() {
  // Try cookie first
  const cookies = document.cookie.split(';');
  for (let cookie of cookies) {
    const [name, value] = cookie.trim().split('=');
    if (name === 'customerAccessToken' || name === '__customer_access_token') {
      return decodeURIComponent(value);
    }
  }
  
  // Try localStorage (if you stored it there)
  return localStorage.getItem('customerAccessToken');
}

// Use it
const token = getCustomerAccessToken();
if (token) {
  // Use token...
}
```

### Option 3: Use Customer Data from Liquid (No Token Needed)

For Liquid templates, use the `customer` object directly:

```liquid
{% if customer %}
  <a href="/apps/xwan-ai-sso/sso?customer_email={{ customer.email | url_param_escape }}&customer_id={{ customer.id }}&first_name={{ customer.first_name | url_param_escape }}&last_name={{ customer.last_name | url_param_escape }}&return_to=/dashboard">
    Go to XWAN.AI
  </a>
{% else %}
  <a href="/account/login">Login First</a>
{% endif %}
```

## How Token is Generated (Internal Shopify Process)

1. **Customer logs in** on Shopify storefront
2. **Shopify calls Storefront API:**
   ```graphql
   mutation customerAccessTokenCreate($input: CustomerAccessTokenCreateInput!) {
     customerAccessTokenCreate(input: $input) {
       customerAccessToken {
         accessToken  # ← This is the token
         expiresAt
       }
     }
   }
   ```
3. **Shopify stores token** in cookie automatically
4. **Token is available** in cookies for subsequent requests

**You don't need to implement this** - Shopify handles it automatically if you're using:
- Customer Account API (new system)
- Storefront API customer mutations

## Recommended Implementation

For your SSO implementation, use **Option 1** (let App Proxy handle it):

```html
<!-- Simple button on your storefront -->
<button onclick="goToXwanAI()" class="btn btn-primary">
  Go to XWAN.AI
</button>

<script>
function goToXwanAI() {
  // Just redirect - App Proxy reads token from cookie automatically
  window.location.href = '/apps/xwan-ai-sso/check-login?return_to=/dashboard';
}
</script>
```

Or with Liquid check:

```liquid
{% if customer %}
  <button onclick="goToXwanAI()" class="btn btn-primary">
    Go to XWAN.AI
  </button>
  <script>
    function goToXwanAI() {
      window.location.href = '/apps/xwan-ai-sso/check-login?return_to=/dashboard';
    }
  </script>
{% else %}
  <a href="/account/login?checkout_url=/apps/xwan-ai-sso/check-login" class="btn btn-primary">
    Login to Access XWAN.AI
  </a>
{% endif %}
```

## Summary

✅ **Token is generated by Shopify** when customer logs in  
✅ **Token is stored in cookie** automatically  
✅ **Your App Proxy reads from cookie** automatically  
✅ **You don't need to manually get/pass token** in most cases  

**Just redirect to `/apps/xwan-ai-sso/check-login` and it works!**

For more details, see `CUSTOMER_ACCESS_TOKEN_GUIDE.md`.
